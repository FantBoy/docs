压缩解压缩接口是用于处理**已经上传到对应存储空间**中的视频文件，进行压缩或解压缩操作，并将结果存储到用户存储空间内的指定位置。在处理完成之后，异步通知用户处理结果。如果原视频文件不在 UPYUN 存储，需要预先调用文件上传 API 将视频文件上传到 UPYUN 存储中。 

> 注：文中所有 `<>` 标注的字段，均需根据实际情况进行替换。

## 使用方法

### 请求方法

以 `POST` 方式向 `http://p0.api.upyun.com/pretreatment/` 提交处理请求，UPYUN 接受请求后立即返回任务 `task_id`，处理完成后会通过回调的方式通知用户。

例如：

```
curl -X POST \
    http://p0.api.upyun.com/pretreatment/ \
    -H "Authorization: UPYUN <operator>:<signature>" \
    -H "Date: <Wed, 29 Oct 2014 02:26:58 GMT>"
    -d "bucket_name=<bucket_name>" \
    -d "notify_url=<notify_url>" \
    -d "source=<upyun>" \
    -d "app_name=unzip"
    -d "tasks=<base64 编码后的任务字符串>"
```

### 请求参数

|        参数       |    类型       | 必选     |   说明                                |
|-------------------|--------------|------|---------------------------------------|
| bucket_name       | string       |  是    | 文件所在空间名称                       |
| notify_url        | string       |  是    | 回调通知地址                          |
| source            | string       |  是   | 可随意填写，并无特殊含义， 但不可为空字符串 |
| tasks             | string       |  是   | 处理任务信息，详见下                    |
| app_name          | string       |  是   | 任务所对应的云处理程序，必须为 `unzip`        |


`tasks` 参数通过下面三个步骤生成：

1\. 组装业务参数。一次最多可以提交 10 个处理任务。

```
[
	{
	    "type": "depress",                       //视频转码
	    "sources": ["/source/t.zip"],            //UPYUN 存储空间中内文件路径
        "save_as": "/result/t/",                 //保存路径
	},
  	{
	    "type": "compress",                       //视频拼接
	    "sources": ["/source/a","/source/b",],    //UPYUN 存储空间中内文件路径
	    "save_as": "/result/a.zip"				   //保存路径
	},
	…
]
```

2\. 把组装好的参数转换为 JSON 字符串。

3\. 对 JSON 字符串进行 base64 编码处理。

### 授权认证

授权认证的方法与异步音视频处理授权认证方法完全一致，具体可参考 [授权认证](http://docs.upyun.com/cloud/av/#_4)。


### 回调通知

处理完成后，系统根据提交任务时的 `notify_url` 参数，将结果以 `HTTP POST` 请求进行回调通知。

** 回调通知参数 **

|        参数       |    类型   |    说明                                                                                                      |
|-------------------|-----------|--------------------------------------------------------------------------------------------------------------|
| TaskId      | string    | 任务对应的 TaskId                          |
| StatusCode  | integer   | 处理结果状态码，200 表示成功处理 |
| UploadPath  | string     | 输出文件保存路径             |
| Error       | string    | 处理错误信息描述，空字符串表示没有错误        |                                                                                      



## 处理参数

### 压缩

用于将用户 UPYUN 存储空间内多个文件或文件夹压缩打包成一个压缩文件。

|        参数       |    类型   |    说明                                                                           |
|-------------------|-----------|-----------------------------------------------------------------------------------|
| type              | string    | 处理类型，值为 `compress`                  |
| save_as           | string    | 压缩文件保存路径（需要为 `zip` 压缩文件），如 `</result/t.zip>`    |
| sources           | array     | 需要被压缩打包的文件或文件夹（空间内相对路径）|



### 解压缩

用于将用户 UPYUN 存储空间内的压缩文件解压，并上传至指定目录。

|        参数       |    类型   |    说明                                                                           |
|-------------------|-----------|-----------------------------------------------------------------------------------|
| type              | string    | 处理类型，值为 `depress`                  |
| save_as           | string    | 压缩文件保存路径（需要为目录），如 `</result/>`      |
| sources           | array     | 空间内压缩文件相对路径（目前仅支持解压一个文件，但此参数类型必须为 `array`）| 
| home_dir          | string     | 压缩文件内的目录结构内可不包含此父目录，若父目录不存在，则默认从 `/` 开始（可选）|